---
title: Brex Webhooks
sidebarTitle: Brex
description: Develop and test Brex webhooks from localhost.
---

import InspectingRequests from "/snippets/integrations/_inspecting-requests.mdx";
import ReplayingRequests from "/snippets/integrations/_replaying-requests.mdx";

This guide walks you through using ngrok to receive Brex webhooks on your localhost app.

By integrating ngrok with Brex, you can:

- Develop and test Brex webhooks locally without deploying to a public environment or setting up HTTPS.
- Inspect and troubleshoot requests from Brex in real time via the inspection UI and API.
- Modify and replay Brex webhook requests with a single click instead of reproducing events manually in your Brex account.
- Secure your app with Brex webhook validation provided by ngrok.
  Invalid requests are blocked by ngrok before reaching your app.

## What you'll need

- An [ngrok account](https://ngrok.com/signup) and your [authtoken](https://dashboard.ngrok.com/get-started/your-authtoken).
- The [ngrok agent](https://ngrok.com/download) installed.
- [Node.js](https://nodejs.org/) installed (for the sample app, or use your own app).
- A Brex account.

## 1. Start your app

For this tutorial, you can use the [sample Node.js app on GitHub](https://github.com/ngrok/ngrok-webhook-nodejs-sample).

To install the sample, run the following in a terminal:

```bash
git clone https://github.com/ngrok/ngrok-webhook-nodejs-sample.git
cd ngrok-webhook-nodejs-sample
npm install
```

Then start the app:

```bash
npm start
```

The app runs on port 3000 by default.

You can confirm it's running by visiting `http://localhost:3000`.
The app logs request headers and body in the terminal and shows a message in the browser.

## 2. Expose your app with ngrok

With your app running locally, expose it with ngrok.

- Copy [your ngrok authtoken](https://dashboard.ngrok.com/get-started/your-authtoken) from the dashboard.

<Tip>
  The ngrok agent uses your authtoken to authenticate when you start a tunnel.
</Tip>

- Start ngrok:

  ```bash
  ngrok http 3000
  ```

- Copy the URL ngrok displays.
  Your app is now exposed at that URL for use with Brex.

## 3. Configure Brex to send webhooks

Brex can send webhook requests to your app when events occur in your account.
To register for those events:

- Sign in to the [Brex Dashboard](https://dashboard.brex.com).
- In the left menu, go to **Settings** and click **Create Token**.
- On **Create an API token**, enter a name in **Token Name**, select **Write** for **Referrals** and **Users**, and click **Create Token**.
- On the next page, click **Allow access** to allow the API to access your Brex account.
- Copy the token value shown, then click **Done**.
- In a terminal, create the webhook:

  ```bash
  curl -i -X POST https://platform.brexapis.com/v1/webhooks \
    -H 'Authorization: Bearer YOUR_TOKEN_HERE' \
    -H 'Content-Type: application/json' \
    -H 'Idempotency-Key: string' \
    -d '{"url": "YOUR_NGROK_URL", "event_types": ["USER_UPDATED"]}'
  ```

  Replace `YOUR_TOKEN_HERE` with the token you copied and `YOUR_NGROK_URL` with your ngrok URL (for example, `https://1a2b-3c4d-5e6f-7g8h-9i0j.ngrok.app`).

The Brex API responds with HTTP 200 and JSON containing `"status": "ACTIVE"`.

### Run webhooks with Brex and ngrok

To trigger webhook calls from Brex to your app:

- In the [Brex Dashboard](https://dashboard.brex.com), go to **Team**, **User**, and click **Invite user**.
- On **New user**, enter the requested information, set the role to **employee**, and click **Send invite**.

Confirm your localhost app receives the event and logs both headers and body in the terminal.

<Note>
  If Brex doesn't send the notification, check the invitee's email, open the Brex invitation, and click **Create account** to accept the invitation.
</Note>

<InspectingRequests />

<ReplayingRequests />

## Secure webhook requests

ngrok can verify that incoming requests are from your Brex webhook so only that traffic reaches your app.

<Note>
  Webhook verification is limited to 500 validations per month on free accounts.
  If you need more, you can upgrade to Hobbyist or Pay-as-you-go.
  See [TPU Pricing](/pricing-limits/traffic-policy-unit-pricing/) for details.
</Note>

To add verification:

- Get your webhook secret from the Brex API:

  ```bash
  curl -i -X GET https://platform.brexapis.com/v1/webhooks/secrets \
    -H 'Authorization: Bearer YOUR_TOKEN_HERE'
  ```

  Replace `YOUR_TOKEN_HERE` with the token you copied when configuring the webhook.
  The response includes JSON with a `"secret"` value; copy it.

- Create a Traffic Policy file named `brex_policy.yml`.
  Replace `{your webhook secret}` with the secret value you copied:

  ```yaml
  on_http_request:
    - actions:
        - type: verify-webhook
          config:
            provider: brex
            secret: "{your webhook secret}"
  ```

- Restart ngrok with the policy file:

  ```bash
  ngrok http 3000 --traffic-policy-file brex_policy.yml
  ```

- Create a new user in the Brex Dashboard (and have the invite accepted) to trigger a webhook.

Your app should receive the request and log it in the terminal.
