---
title: Bitbucket Repository Webhooks
sidebarTitle: Bitbucket Repository
description: Develop and test Bitbucket webhooks from localhost.
---

import InspectingRequests from "/snippets/integrations/_inspecting-requests.mdx";
import ReplayingRequests from "/snippets/integrations/_replaying-requests.mdx";

This guide walks you through using ngrok to receive Bitbucket repository webhooks on your localhost app.

By integrating ngrok with Bitbucket, you can:

- Develop and test Bitbucket webhooks locally without deploying to a public environment or setting up HTTPS.
- Inspect and troubleshoot requests from Bitbucket in real time via the inspection UI and API.
- Modify and replay Bitbucket webhook requests with a single click instead of reproducing events manually in your Bitbucket account.

## What you'll need

- An [ngrok account](https://ngrok.com/signup) and your [authtoken](https://dashboard.ngrok.com/get-started/your-authtoken).
- The [ngrok agent](https://ngrok.com/download) installed.
- [Node.js](https://nodejs.org/) installed (for the sample app, or use your own app).
- A Bitbucket account and a repository.

## 1. Start your app

For this tutorial, you can use the [sample Node.js app on GitHub](https://github.com/ngrok/ngrok-webhook-nodejs-sample).

To install the sample, run the following in a terminal:

```bash
git clone https://github.com/ngrok/ngrok-webhook-nodejs-sample.git
cd ngrok-webhook-nodejs-sample
npm install
```

Then start the app:

```bash
npm start
```

The app runs on port 3000 by default.

You can confirm it's running by visiting `http://localhost:3000`.
The app logs request headers and body in the terminal and shows a message in the browser.

## 2. Expose your app with ngrok

Once your app is running locally, you're ready to put it online securely using ngrok.

- Copy [your ngrok authtoken](https://dashboard.ngrok.com/get-started/your-authtoken) from the dashboard.

<Tip>
  The ngrok agent uses your authtoken to authenticate when you start a tunnel.
</Tip>

- Start ngrok:

  ```bash
  ngrok http 3000
  ```

- Copy the URL ngrok displays.
  Your app is now exposed at that URL for use with Bitbucket.

## 3. Configure Bitbucket to send webhooks

Bitbucket can send webhook requests to your app when repository events occur.
To register for those events:

- Sign in to [Bitbucket](https://bitbucket.com/).
- Click **Repositories** in the top menu and open a repository from the list.

<Tip>
  If you don't have a repository, create an empty one first.
</Tip>

- In the repository, go to **Repository settings** in the left menu and click **Webhooks**.
- On the **Webhooks** page, click **Add webhook**.
- On **Add new webhook**, enter a **Title** and paste the ngrok URL in **URL** (for example, `https://1a2b-3c4d-5e6f-7g8h-9i0j.ngrok.app`).
- Under **Triggers**, check **Push** and click **Save**.

### Run webhooks with Bitbucket and ngrok

With **Push** as the trigger, Bitbucket sends a POST request to your app through ngrok when you push to the repository.

<Note>
  The payload your app receives depends on the trigger event you chose.
</Note>

To trigger a push event:

- In the repository, click **â€¦** and then **Add file**.
- On the **Source** page, enter a filename in **Filename** and add content in the text box (for example, `This is my new file content`).
- Click **Commit**, then **Commit** in the popup.

Confirm your localhost app receives the push event and logs both headers and body in the terminal.

Alternatively, clone the repository locally, make changes, commit, and push:

```bash
git add .
git commit -m "my first commit"
git push
```

<InspectingRequests />

<ReplayingRequests />

## Secure webhook requests

You can restrict or verify traffic in two ways depending on your Bitbucket setup.

**Bitbucket Cloud:** Use ngrok IP restrictions to allow ingress only from Bitbucket Cloud IP addresses.

<Note>
  IP restrictions require an ngrok Pro or Enterprise plan.
  You can find Bitbucket Cloud IP addresses in [Bitbucket Support](https://support.atlassian.com/bitbucket-cloud/docs/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall/).
</Note>

- In the [ngrok dashboard](https://dashboard.ngrok.com), go to **Security** and **IP Restrictions**.
- In **Agent**, click **Attach IP Policies**, **New IP Policy**, and **Add Rule**.
- In **Add Rule**, click **Allow** and enter a CIDR that covers the Bitbucket IP (for example, `123.456.789.1/32`) in **CIDR**.
- Enter a **Description** for the rule and policy, click **Save**, then **Attach IP Policy**.
- On **IP Restrictions**, click **Save**.

**Bitbucket Server:** Use ngrok webhook verification so only requests from your Bitbucket webhook reach your app.

<Note>
  Webhook verification is limited to 500 validations per month on free accounts.
  If you need more, you can upgrade to Hobbyist or Pay-as-you-go.
  See [TPU Pricing](/pricing-limits/traffic-policy-unit-pricing/) for details.
</Note>

- In your Bitbucket repository, open the webhook page and edit the webhook.
- In **Authentication**, select **Secret token** and enter a secret value.
- Create a Traffic Policy file named `bitbucket_policy.yml`.
  Replace `{your secret token}` with that value:

  ```yaml
  on_http_request:
    - actions:
        - type: verify-webhook
          config:
            provider: bitbucket
            secret: "{your secret token}"
  ```

- Restart ngrok with the policy file:

  ```bash
  ngrok http 3000 --traffic-policy-file bitbucket_policy.yml
  ```

- Add and commit a new file in the repository to trigger the webhook.

Your app should receive the request and log it in the terminal.
