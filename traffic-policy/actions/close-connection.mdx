---
title: Close Connection Action
sidebarTitle: Close Connection
description: Forcibly close connections to an endpoint.
---


import { ConfigField } from "/snippets/ConfigTable.jsx";
import ActionVariablesDescription from "/snippets/traffic-policy/common/action-variables-description.mdx";
import TerminatingExplanation from "/snippets/traffic-policy/common/terminating-explanation.mdx";

The Close Connection Traffic Policy action lets you forcibly close connections to an endpoint when certain conditions are met, for example, when the number of requests exceeds a given limit (to mitigate DDoS attacks).

This action can be used with other actions such as [rate-limit](/traffic-policy/actions/rate-limit) and [deny](/traffic-policy/actions/deny).

## Configuration reference

The [Traffic Policy](/traffic-policy/) configuration reference for this action.

### Supported phases

`on_http_request`, `on_tcp_connect`

### Type

`close-connection`

### Configuration fields

<Note>  This action does not have any configuration fields.
  
</Note>

## Behavior

When this action is executed, connection to the endpoint is closed immediately.

This can be useful for dealing with DDoS attacks.

### Terminating action

<TerminatingExplanation />

## Examples

### Basic example

This basic example configuration will guide you through setting up an endpoint on ngrok (`hotdog.ngrok.app`) and closing the connection to the endpoint.

<Steps>
  <Step title="Save the following Traffic Policy document to a file called policy.yml">
    ```yaml policy.yml
    on_http_request:
  - name: "Immediately close connection"
      expressions:
  - req.url.path.startsWith("/dc")
      actions:
  - type: close-connection
    ```
  </Step>

  <Step title="Start the endpoint with the Traffic Policy">

```bash
ngrok http 8080 --url hotdog.ngrok.app --traffic-policy-file ./policy.yml
```

  </Step>

  <Step title="Send a request to the endpoint">
    ```bash
    curl http://hotdog.ngrok.app/dc
    ```

    You should see something similar to the following:

    ```bash
    curl: (16) Error in the HTTP2 framing layer
    ```

    This is expected as the connection is closed immediately.

  </Step>
  
</Steps>

## Action result variables

<ActionVariablesDescription />

<Note>  This action does not set any variables after it has been executed.
  
</Note>
