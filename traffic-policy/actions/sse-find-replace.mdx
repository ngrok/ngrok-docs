---
title: SSE Find & Replace Action
sidebarTitle: SSE Find & Replace
description: Find and replace text patterns in Server-Sent Events (SSE) streams.
---


import { ConfigField } from "/snippets/ConfigTable.jsx";
import ActionVariablesDescription from "/snippets/traffic-policy/common/action-variables-description.mdx";
import NonTerminatingExplanation from "/snippets/traffic-policy/common/non-terminating-explanation.mdx";

The SSE Find & Replace action enables you to modify Server-Sent Events stream content by finding and replacing text patterns using regular expressions.
This is particularly useful for modifying streaming AI model responses in real-time, such as redacting sensitive information or transforming content as it streams to clients.

## Configuration reference

The [Traffic Policy](/traffic-policy/) configuration reference for this action.

### Supported phases

`on_event_stream_message`

### Type

`sse-find-replace`

### Configuration fields

<ConfigField title="replacements" type="array" required={true}>
  Array of replacement rules to apply to SSE messages. Rules are applied in order.

  Minimum `1` replacement required.

  <ConfigField title="field" type="string">
  The SSE field to apply the replacement to.
  Valid values are `data` and `retry`.
  Defaults to `data` if not specified.
  CEL interpolation is supported.
</ConfigField>

<ConfigField title="from" type="string" required={true} cel={true}>
  Regular expression pattern to match.
  Supports [RE2 syntax](https://github.com/google/re2/wiki/Syntax).
  CEL interpolation is supported for dynamic patterns.
</ConfigField>

  <ConfigField title="to" type="string" cel={true}>
  Replacement string.
  Use `$1`, `$2`, etc. to reference capture groups from the pattern.
  CEL interpolation is supported for dynamic replacements.
  If omitted or empty, matched text is deleted.
  

  

  
  </ConfigField>
</ConfigField>

## Behavior

When this action executes, it processes each SSE message as it streams through ngrok, applying replacement rules to the specified fields.

### SSE message structure

Server-Sent Events consist of messages with fields like `data`, `event`, `id`, and `retry`.
This action currently supports modifying the `data` and `retry` fields.

### Pattern matching

The `from` field accepts [RE2 regular expressions](https://github.com/google/re2/wiki/Syntax).
All matches within the specified field are replaced, not just the first occurrence.

### Streaming behavior

Unlike the request/response body find & replace actions, this action processes messages in real-time as they stream through.
Each SSE message is processed independently.

### Capture groups

You can use capture groups in your pattern and reference them in the replacement:

```yaml
replacements:
  - field: data
    from: '"sensitive_id":\s*"([^"]+)"'
    to: '"sensitive_id": "[REDACTED]"'
```

### CEL expressions

The `field`, `from`, and `to` parameters all support CEL interpolation for dynamic values:

```yaml
replacements:
  - field: "${vars.target_field}"
    from: "${vars.pattern}"
    to: "${vars.replacement}"
```

When using CEL in the `from` field, the resulting string must be a valid regular expression.

### Non-terminating action

<NonTerminatingExplanation />

## Examples

### Redacting sensitive data from streaming AI responses

When using streaming AI responses (like OpenAI's chat completions with `stream: true`), you can redact sensitive information in real-time.

#### Example Traffic Policy document

<CodeGroup>
  ```yaml policy.yml
  on_event_stream_message:
  - actions:
  - type: sse-find-replace
        config:
          replacements:
            # Redact SSN patterns in streaming content
  - field: data
              from: "\\d{3}-\\d{2}-\\d{4}"
              to: "[SSN REDACTED]"
            # Redact email addresses
  - field: data
              from: "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"
              to: "[EMAIL REDACTED]"
  ```
  ```json policy.json
  {
  "on_event_stream_message": [
    {
      "actions": [
        {
          "type": "sse-find-replace",
          "config": {
            "replacements": [
              {
                "field": "data",
                "from": "\\d{3}-\\d{2}-\\d{4}",
                "to": "[SSN REDACTED]"
              },
              {
                "field": "data",
                "from": "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",
                "to": "[EMAIL REDACTED]"
              }
            ]
          }
        }
      ]
    }
  ]
  }
  ```
  
</CodeGroup>

### Modifying streaming AI output format

Transform streaming content as it's delivered to clients:

<CodeGroup>
  ```yaml policy.yml
  on_event_stream_message:
  - actions:
  - type: sse-find-replace
        config:
          replacements:
            # Add emphasis to certain keywords
  - field: data
              from: "\\b(IMPORTANT|WARNING|NOTE)\\b"
              to: "**$1**"
  ```
  ```json policy.json
  {
  "on_event_stream_message": [
    {
      "actions": [
        {
          "type": "sse-find-replace",
          "config": {
            "replacements": [
              {
                "field": "data",
                "from": "\\b(IMPORTANT|WARNING|NOTE)\\b",
                "to": "**$1**"
              }
            ]
          }
        }
      ]
    }
  ]
  }
  ```
  
</CodeGroup>

### Filtering profanity from streaming responses

Remove or replace inappropriate content from AI responses in real-time:

<CodeGroup>
  ```yaml policy.yml
  on_event_stream_message:
  - actions:
  - type: sse-find-replace
        config:
          replacements:
  - field: data
              from: "\\b(badword1|badword2|badword3)\\b"
              to: "[filtered]"
  ```
  ```json policy.json
  {
  "on_event_stream_message": [
    {
      "actions": [
        {
          "type": "sse-find-replace",
          "config": {
            "replacements": [
              {
                "field": "data",
                "from": "\\b(badword1|badword2|badword3)\\b",
                "to": "[filtered]"
              }
            ]
          }
        }
      ]
    }
  ]
  }
  ```
  
</CodeGroup>

### Modifying retry behavior

Change the retry interval in SSE streams:

<CodeGroup>
  ```yaml policy.yml
  on_event_stream_message:
  - actions:
  - type: sse-find-replace
        config:
          replacements:
  - field: retry
              from: "\\d+"
              to: "5000"
  ```
  ```json policy.json
  {
  "on_event_stream_message": [
    {
      "actions": [
        {
          "type": "sse-find-replace",
          "config": {
            "replacements": [
              {
                "field": "retry",
                "from": "\\d+",
                "to": "5000"
              }
            ]
          }
        }
      ]
    }
  ]
  }
  ```
  
</CodeGroup>

## Action result variables

<ActionVariablesDescription />

<ConfigField title="actions.ngrok.sse_find_replace.replacements" type="array">
  Array of objects describing which replacement rules matched.

  <ConfigField title="replacement_index" type="integer">
  The zero-based index of the replacement rule that matched.
  
</ConfigField>

  <ConfigField title="matched_content" type="string">
    The first matched content from this replacement rule.
  

  

  
  </ConfigField>
</ConfigField>

## Related actions

- [Request Body Find & Replace](/traffic-policy/actions/request-body-find-replace) - Modify request bodies
- [Response Body Find & Replace](/traffic-policy/actions/response-body-find-replace) - Modify response bodies
