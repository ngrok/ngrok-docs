---
title: Traffic Policy Unit (TPU) Pricing
sidebar_label: Traffic Policy Pricing
description: Learn about how ngrok uses Traffic Processing Units (TPUs) to measure and charge for traffic policy usage.
---

Traffic Processing Units (TPUs) are ngrok's usage-based metric for measuring the work your traffic policies perform. Because requests can include any mix of expressions, macros, and actions—often applied only to a subset of traffic—charging a flat rate per request or connection would usually result in overcharging. Instead, ngrok calculates TPUs dynamically for each request, based only on the parts of the traffic policy that were actually executed.

TPUs are sold in bundles of 100,000 for $1 and are charged as your policies execute.

## TPU pricing breakdown

- [**Actions**](/traffic-policy/concepts/actions/): Define what happens when a traffic policy rule matches (such as adding headers, denying a request, or forwarding traffic).
- [**Macros**](/traffic-policy/macros/): Macros can be used within the Traffic Policy engine to simplify traffic management and dynamic configuration.
- [**Variables**](/traffic-policy/variables/): Metadata about connections or requests that you can use in expressions or actions (such as the client IP or headers).

### Actions

| Name                                                              | TPU Cost |
| ----------------------------------------------------------------- | -------- |
| [add-headers](/traffic-policy/actions/add-headers/)               | Free     |
| [basic-auth](/traffic-policy/actions/basic-auth/)                 | Free     |
| [circuit-breaker](/traffic-policy/actions/circuit-breaker/)       | 10 TPUs  |
| [compress-response](/traffic-policy/actions/compress-response/)   | 10 TPUs  |
| [custom-response](/traffic-policy/actions/custom-response/)       | Free     |
| [deny](/traffic-policy/actions/deny/)                             | Free     |
| [forward-internal](/traffic-policy/actions/forward-internal/)     | Free     |
| [forward-external](/traffic-policy/actions/forward-external/)     | 10 TPUs  |
| [http-request](/traffic-policy/actions/http-request/)             | 1 TPU    |
| [jwt-validation](/traffic-policy/actions/jwt-validation/)         | 10 TPUs  |
| [log](/traffic-policy/actions/log/)                               | Free     |
| [oauth](/traffic-policy/actions/oauth/)                           | Free     |
| [oidc](/traffic-policy/actions/oidc/)                             | Free     |
| [owasp-crs-request](/traffic-policy/actions/owasp-crs-request/)   | 10 TPUs  |
| [owasp-crs-response](/traffic-policy/actions/owasp-crs-response/) | 10 TPUs  |
| [rate-limit](/traffic-policy/actions/rate-limit/)                 | 1 TPU    |
| [redirect](/traffic-policy/actions/redirect/)                     | 10 TPUs  |
| [remove-headers](/traffic-policy/actions/remove-headers/)         | 1 TPU    |
| [restrict-ips](/traffic-policy/actions/restrict-ips/)             | 10 TPUs  |
| [saml](/traffic-policy/actions/saml/)                             | Free     |
| [set-vars](/traffic-policy/actions/set-vars/)                     | Free     |
| [terminate-tls](/traffic-policy/actions/terminate-tls/)           | 100 TPUs |
| [url-rewrite](/traffic-policy/actions/url-rewrite/)               | 10 TPUs  |
| [verify-webhook](/traffic-policy/actions/verify-webhook/)         | 1 TPU    |

### Macros

| Name                                                                                | TPU Cost                 |
| ----------------------------------------------------------------------------------- | ------------------------ |
| [b64.decode(string)](/traffic-policy/macros/#base64)                                | 3 TPUs per GB after 1 GB |
| [b64.encode(string)](/traffic-policy/macros/#base64)                                | 3 TPUs per GB after 1 GB |
| [basic_auth.encode(username, password)](/traffic-policy/macros/#basic-auth)         | Free                     |
| [http.header(name)](/traffic-policy/macros/#http-requests)                          | Free                     |
| [http.header(name, default)](/traffic-policy/macros/#http-requests)                 | Free                     |
| [http.param(name)](/traffic-policy/macros/#http-requests)                           | Free                     |
| [http.param(name, default)](/traffic-policy/macros/#http-requests)                  | Free                     |
| [http.path()](/traffic-policy/macros/#http-requests)                                | Free                     |
| [http.path_segment(index)](/traffic-policy/macros/#http-requests)                   | Free                     |
| [http.path_segment(index, default)](/traffic-policy/macros/#http-requests)          | Free                     |
| [http.query()](/traffic-policy/macros/#http-requests)                               | Free                     |
| [http.query_param(name)](/traffic-policy/macros/#http-requests)                     | Free                     |
| [http.query_param(name, default)](/traffic-policy/macros/#http-requests)            | Free                     |
| [http.remote_addr()](/traffic-policy/macros/#http-requests)                         | Free                     |
| [http.request_body()](/traffic-policy/macros/#http-requests)                        | Free                     |
| [http.request_body_json()](/traffic-policy/macros/#http-requests)                   | Free                     |
| [http.request_body_query()](/traffic-policy/macros/#http-requests)                  | Free                     |
| [http.request_method()](/traffic-policy/macros/#http-requests)                      | Free                     |
| [http.request_uri()](/traffic-policy/macros/#http-requests)                         | Free                     |
| [http.response_body()](/traffic-policy/macros/#http-responses)                      | Free                     |
| [http.response_body_json()](/traffic-policy/macros/#http-responses)                 | Free                     |
| [http.response_body_query()](/traffic-policy/macros/#http-responses)                | Free                     |
| [http.scheme()](/traffic-policy/macros/#http-requests)                              | Free                     |
| [http.status()](/traffic-policy/macros/#http-responses)                             | Free                     |
| [http.status_text()](/traffic-policy/macros/#http-responses)                        | Free                     |
| [http.user_agent()](/traffic-policy/macros/#http-requests)                          | Free                     |
| [inCidrRange(ip, cidr)](/traffic-policy/macros/#utility)                            | Free                     |
| [inCidrRanges(ip, cidrs)](/traffic-policy/macros/#utility)                          | Free                     |
| [json.decode(string)](/traffic-policy/macros/#json)                                 | 3 TPUs per GB after 1 GB |
| [json.encode(list\| map)](/traffic-policy/macros/#json)                             | 3 TPUs per GB after 1 GB |
| [list.encodeJson()](/traffic-policy/macros/#lists)                                  | Free                     |
| [object.encodeJson()](/traffic-policy/macros/#maps)                                 | Free                     |
| [object.encodeQueryString()](/traffic-policy/macros/#maps)                          | Free                     |
| [queryString.decode(string)](/traffic-policy/macros/#query-string)                  | Free                     |
| [queryString.encode(map)](/traffic-policy/macros/#query-string)                     | Free                     |
| [rand.double()](/traffic-policy/macros/#random)                                     | Free                     |
| [rand.int(min, max)](/traffic-policy/macros/#random)                                | Free                     |
| [security.secret(string, string)](/traffic-policy/macros/#secrets)                  | Free                     |
| [string.decodeBase64()](/traffic-policy/macros/#string)                             | Free                     |
| [string.decodeJson()](/traffic-policy/macros/#string)                               | Free                     |
| [string.decodeQueryString()](/traffic-policy/macros/#string)                        | Free                     |
| [string.encodeBase64()](/traffic-policy/macros/#string)                             | Free                     |
| [string.escapeUrl()](/traffic-policy/macros/#string)                                | Free                     |
| [string.isJson()](/traffic-policy/macros/#string)                                   | Free                     |
| [string.isQueryString()](/traffic-policy/macros/#string)                            | Free                     |
| [string.isURL()](/traffic-policy/macros/#string)                                    | Free                     |
| [string.parseUrl()](/traffic-policy/macros/#string)                                 | Free                     |
| [string.unescapeUrl()](/traffic-policy/macros/#string)                              | Free                     |
| [url.escape(string)](/traffic-policy/macros/#url)                                   | Free                     |
| [url.parse(string)](/traffic-policy/macros/#url)                                    | Free                     |
| [url.unescape(string)](/traffic-policy/macros/#url)                                 | Free                     |
| [utility.base64_decode(string)](/traffic-policy/macros/#base64)                     | Free                     |
| [utility.base64_encode(string)](/traffic-policy/macros/#base64)                     | Free                     |
| [utility.basic_auth_encode(username, password)](/traffic-policy/macros/#basic-auth) | Free                     |
| [utility.in_cidr_range(ip, cidr)](/traffic-policy/macros/#utility)                  | Free                     |
| [utility.in_cidr_ranges(ip, cidrs)](/traffic-policy/macros/#utility)                | Free                     |
| [utility.json_decode(string)](/traffic-policy/macros/#json)                         | Free                     |
| [utility.json_encode(list \| map)](/traffic-policy/macros/#json)                    | Free                     |
| [utility.list_encode_json()](/traffic-policy/macros/#lists)                         | Free                     |
| [utility.object_encode_json()](/traffic-policy/macros/#maps)                        | Free                     |
| [utility.object_encode_query_string()](/traffic-policy/macros/#maps)                | Free                     |
| [utility.query_string_decode(string)](/traffic-policy/macros/#query-string)         | Free                     |
| [utility.query_string_encode(map)](/traffic-policy/macros/#query-string)            | Free                     |
| [utility.rand_double()](/traffic-policy/macros/#random)                             | Free                     |
| [utility.rand_int(min, max)](/traffic-policy/macros/#random)                        | Free                     |
| [utility.string_decode_base64()](/traffic-policy/macros/#string)                    | Free                     |
| [utility.string_decode_json()](/traffic-policy/macros/#string)                      | Free                     |
| [utility.string_decode_query_string()](/traffic-policy/macros/#string)              | Free                     |
| [utility.string_encode_base64()](/traffic-policy/macros/#string)                    | Free                     |
| [utility.string_escape_url()](/traffic-policy/macros/#string)                       | Free                     |
| [utility.string_is_json()](/traffic-policy/macros/#string)                          | Free                     |
| [utility.string_is_query_string()](/traffic-policy/macros/#string)                  | Free                     |
| [utility.string_is_url()](/traffic-policy/macros/#string)                           | Free                     |
| [utility.string_parse_url()](/traffic-policy/macros/#string)                        | Free                     |
| [utility.string_unescape_url()](/traffic-policy/macros/#string)                     | Free                     |
| [utility.url_escape(string)](/traffic-policy/macros/#url)                           | Free                     |
| [utility.url_parse(string)](/traffic-policy/macros/#url)                            | Free                     |
| [utility.url_unescape(string)](/traffic-policy/macros/#url)                         | Free                     |

### Variables

| Name                                                                                                     | TPU Cost |
| -------------------------------------------------------------------------------------------------------- | -------- |
| [actions.ngrok.add_headers.headers_added](/traffic-policy/variables/action/#add-headers)                 | Free     |
| [actions.ngrok.basic_auth.credentials.presented](/traffic-policy/variables/action/#basic-auth)           | Free     |
| [actions.ngrok.basic_auth.credentials.username](/traffic-policy/variables/action/#basic-auth)            | Free     |
| [actions.ngrok.basic_auth.credentials.authorized](/traffic-policy/variables/action/#basic-auth)          | Free     |
| [actions.ngrok.compress.already_compressed](/traffic-policy/variables/action/#compress-response)         | Free     |
| [actions.ngrok.compress.negotiated_algorithm](/traffic-policy/variables/action/#compress-response)       | Free     |
| [actions.ngrok.http_request.error.code](/traffic-policy/variables/action/#http-request)                  | Free     |
| [actions.ngrok.http_request.error.message](/traffic-policy/variables/action/#http-request)               | Free     |
| [actions.ngrok.http_request.attempts](/traffic-policy/variables/action/#http-request)                    | Free     |
| [actions.ngrok.http_request.req](/traffic-policy/variables/action/#http-request)                         | Free     |
| [actions.ngrok.http_request.res](/traffic-policy/variables/action/#http-request)                         | Free     |
| [actions.ngrok.jwt_validation.tokens](/traffic-policy/variables/action/#jwt-validation)                  | Free     |
| [actions.ngrok.jwt_validation.error.code](/traffic-policy/variables/action/#jwt-validation)              | Free     |
| [actions.ngrok.jwt_validation.error.message](/traffic-policy/variables/action/#jwt-validation)           | Free     |
| [actions.ngrok.log.metadata](/traffic-policy/variables/action/#log)                                      | Free     |
| [actions.ngrok.oauth.error.code](/traffic-policy/variables/action/#oauth)                                | Free     |
| [actions.ngrok.oauth.error.message](/traffic-policy/variables/action/#oauth)                             | Free     |
| [actions.ngrok.oauth.identity.id](/traffic-policy/variables/action/#oauth)                               | Free     |
| [actions.ngrok.oauth.identity.email](/traffic-policy/variables/action/#oauth)                            | Free     |
| [actions.ngrok.oauth.identity.name](/traffic-policy/variables/action/#oauth)                             | Free     |
| [actions.ngrok.oauth.identity.provider_user_id](/traffic-policy/variables/action/#oauth)                 | Free     |
| [actions.ngrok.oauth.identity.current_provider_session_id](/traffic-policy/variables/action/#oauth)      | Free     |
| [actions.ngrok.oauth.access_token](/traffic-policy/variables/action/#oauth)                              | Free     |
| [actions.ngrok.oauth.refresh_token](/traffic-policy/variables/action/#oauth)                             | Free     |
| [actions.ngrok.oauth.expires_at](/traffic-policy/variables/action/#oauth)                                | Free     |
| [actions.ngrok.oauth.session_timed_out](/traffic-policy/variables/action/#oauth)                         | Free     |
| [actions.ngrok.oauth.session_max_duration_reached](/traffic-policy/variables/action/#oauth)              | Free     |
| [actions.ngrok.oidc.error.code](/traffic-policy/variables/action/#openid-connect-oidc)                   | Free     |
| [actions.ngrok.oidc.error.message](/traffic-policy/variables/action/#openid-connect-oidc)                | Free     |
| [actions.ngrok.oidc.identity.id](/traffic-policy/variables/action/#openid-connect-oidc)                  | Free     |
| [actions.ngrok.oidc.identity.email](/traffic-policy/variables/action/#openid-connect-oidc)               | Free     |
| [actions.ngrok.oidc.identity.name](/traffic-policy/variables/action/#openid-connect-oidc)                | Free     |
| [actions.ngrok.oidc.identity.provider_user_id](/traffic-policy/variables/action/#openid-connect-oidc)    | Free     |
| [actions.ngrok.oidc.identity.current_session_id](/traffic-policy/variables/action/#openid-connect-oidc)  | Free     |
| [actions.ngrok.oidc.identity_token](/traffic-policy/variables/action/#openid-connect-oidc)               | Free     |
| [actions.ngrok.oidc.access_token](/traffic-policy/variables/action/#openid-connect-oidc)                 | Free     |
| [actions.ngrok.oidc.refresh_token](/traffic-policy/variables/action/#openid-connect-oidc)                | Free     |
| [actions.ngrok.oidc.expires_at](/traffic-policy/variables/action/#openid-connect-oidc)                   | Free     |
| [actions.ngrok.oidc.session_timed_out](/traffic-policy/variables/action/#openid-connect-oidc)            | Free     |
| [actions.ngrok.oidc.session_max_duration_reached](/traffic-policy/variables/action/#openid-connect-oidc) | Free     |
| [actions.ngrok.oidc.userinfo_refreshed](/traffic-policy/variables/action/#openid-connect-oidc)           | Free     |
| [actions.ngrok.rate_limit.bucket_key](/traffic-policy/variables/action/#rate-limit)                      | Free     |
| [actions.ngrok.rate_limit.limited](/traffic-policy/variables/action/#rate-limit)                         | Free     |
| [actions.ngrok.rate_limit.error.code](/traffic-policy/variables/action/#rate-limit)                      | Free     |
| [actions.ngrok.rate_limit.error.message](/traffic-policy/variables/action/#rate-limit)                   | Free     |
| [actions.ngrok.redirect.matches](/traffic-policy/variables/action/#redirect)                             | Free     |
| [actions.ngrok.redirect.url](/traffic-policy/variables/action/#redirect)                                 | Free     |
| [actions.ngrok.redirect.error.code](/traffic-policy/variables/action/#redirect)                          | Free     |
| [actions.ngrok.redirect.error.message](/traffic-policy/variables/action/#redirect)                       | Free     |
| [actions.ngrok.remove_headers.headers_removed](/traffic-policy/variables/action/#remove-headers)         | Free     |
| [actions.ngrok.restrict_ips.action](/traffic-policy/variables/action/#restrict-ips)                      | Free     |
| [actions.ngrok.restrict_ips.matched_cidr](/traffic-policy/variables/action/#restrict-ips)                | Free     |
| [actions.ngrok.restrict_ips.error.code](/traffic-policy/variables/action/#restrict-ips)                  | Free     |
| [actions.ngrok.restrict_ips.error.message](/traffic-policy/variables/action/#restrict-ips)               | Free     |
| [actions.ngrok.url_rewrite.matches](/traffic-policy/variables/action/#url-rewrite)                       | Free     |
| [actions.ngrok.url_rewrite.url](/traffic-policy/variables/action/#url-rewrite)                           | Free     |
| [actions.ngrok.url_rewrite.error.code](/traffic-policy/variables/action/#url-rewrite)                    | Free     |
| [actions.ngrok.url_rewrite.error.message](/traffic-policy/variables/action/#url-rewrite)                 | Free     |
| [actions.ngrok.verify_webhook.verified](/traffic-policy/variables/action/#verify-webhook)                | Free     |
| [conn.bytes_in](/traffic-policy/variables/connection/#connbytes_in)                                      | Free     |
| [conn.bytes_out](/traffic-policy/variables/connection/#connbytes_out)                                    | Free     |
| [conn.client_ip](/traffic-policy/variables/connection/#connclient_ip)                                    | Free     |
| [conn.client_port](/traffic-policy/variables/connection/#connclient_port)                                | Free     |
| [conn.server_ip](/traffic-policy/variables/connection/#connserver_ip)                                    | Free     |
| [conn.server_port](/traffic-policy/variables/connection/#connserver_port)                                | Free     |
| [conn.server_region](/traffic-policy/variables/connection/#connserver_region)                            | Free     |
| [conn.ts.start](/traffic-policy/variables/connection/#conntsstart)                                       | Free     |

## Traffic Policy Unit (TPU) discounts at scale

The Pay-as-you-go plan provides discounts on TPUs for large scale deployments so you always get the best price as you grow. Discounted pricing is as follows:

| Count | TPU Cost   |
| ----- | ---------- |
| 0+    | $1/100k    |
| 1M+   | $.75/100k  |
| 10M+  | $.55/100k  |
| 100M+ | $0.35/100k |
| 1B+   | $0.25/100k |
