# Traffic Policy Unit (TPU) Pricing

## Definition--What are TPUs?

Traffic Processing Units (TPUs) are ngrok's usage-based unit for measuring how much processing your traffic policies perform. Instead of charging per request or connection, ngrok charges based combined cost of the actions, variables, and macros you use. TPUs are sold in bundles of 100,000 for $1, and are deducted as your policies run.

## Actions, Expressions, and Variables

- [**Actions**](https://ngrok.com/docs/traffic-policy/concepts/actions/): Define what happens when a traffic policy rule matches (e.g. add headers, deny a request, forward traffic).
- [**Expressions**](https://ngrok.com/docs/traffic-policy/concepts/expressions/): Conditions (written in CEL) that determine whether actions execute, based on request or connection properties.
- [**Variables**](https://ngrok.com/docs/traffic-policy/variables/): Metadata about connections or requests that you can use in expressions or actions (e.g. client IP, headers).

## Pricing Tables

Below are the TPU costs for variables, actions, and macros.

### Variables

| Name | TPU Cost |
|------|----------|
| Name | TPU Cost |
|---|---|
| [actions.ngrok.add_headers.headers_added](https://ngrok.com/docs/traffic-policy/variables/action/#add-headers) | Free |
| [actions.ngrok.basic_auth.credentials.presented](https://ngrok.com/docs/traffic-policy/variables/action/#basic-auth) | Free |
| [actions.ngrok.basic_auth.credentials.username](https://ngrok.com/docs/traffic-policy/variables/action/#basic-auth) | Free |
| [actions.ngrok.basic_auth.credentials.authorized](https://ngrok.com/docs/traffic-policy/variables/action/#basic-auth) | Free |
| [actions.ngrok.compress.already_compressed](https://ngrok.com/docs/traffic-policy/variables/action/#compress-response) | Free |
| [actions.ngrok.compress.negotiated_algorithm](https://ngrok.com/docs/traffic-policy/variables/action/#compress-response) | Free |
| [actions.ngrok.http_request.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#http-request) | Free |
| [actions.ngrok.http_request.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#http-request) | Free |
| [actions.ngrok.http_request.attempts](https://ngrok.com/docs/traffic-policy/variables/action/#http-request) | Free |
| [actions.ngrok.http_request.req](https://ngrok.com/docs/traffic-policy/variables/action/#http-request) | Free |
| [actions.ngrok.http_request.res](https://ngrok.com/docs/traffic-policy/variables/action/#http-request) | Free |
| [actions.ngrok.jwt_validation.tokens](https://ngrok.com/docs/traffic-policy/variables/action/#jwt-validation) | Free |
| [actions.ngrok.jwt_validation.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#jwt-validation) | Free |
| [actions.ngrok.jwt_validation.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#jwt-validation) | Free |
| [actions.ngrok.log.metadata](https://ngrok.com/docs/traffic-policy/variables/action/#log) | Free |
| [actions.ngrok.oauth.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.identity.id](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.identity.email](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.identity.name](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.identity.provider_user_id](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.identity.current_provider_session_id](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.access_token](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.refresh_token](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.expires_at](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.session_timed_out](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oauth.session_max_duration_reached](https://ngrok.com/docs/traffic-policy/variables/action/#oauth) | Free |
| [actions.ngrok.oidc.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.identity.id](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.identity.email](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.identity.name](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.identity.provider_user_id](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.identity.current_session_id](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.identity_token](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.access_token](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.refresh_token](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.expires_at](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.session_timed_out](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.session_max_duration_reached](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.oidc.userinfo_refreshed](https://ngrok.com/docs/traffic-policy/variables/action/#openid-connect-oidc) | Free |
| [actions.ngrok.rate_limit.bucket_key](https://ngrok.com/docs/traffic-policy/variables/action/#rate-limit) | Free |
| [actions.ngrok.rate_limit.limited](https://ngrok.com/docs/traffic-policy/variables/action/#rate-limit) | Free |
| [actions.ngrok.rate_limit.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#rate-limit) | Free |
| [actions.ngrok.rate_limit.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#rate-limit) | Free |
| [actions.ngrok.redirect.matches](https://ngrok.com/docs/traffic-policy/variables/action/#redirect) | Free |
| [actions.ngrok.redirect.url](https://ngrok.com/docs/traffic-policy/variables/action/#redirect) | Free |
| [actions.ngrok.redirect.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#redirect) | Free |
| [actions.ngrok.redirect.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#redirect) | Free |
| [actions.ngrok.remove_headers.headers_removed](https://ngrok.com/docs/traffic-policy/variables/action/#remove-headers) | Free |
| [actions.ngrok.restrict_ips.action](https://ngrok.com/docs/traffic-policy/variables/action/#restrict-ips) | Free |
| [actions.ngrok.restrict_ips.matched_cidr](https://ngrok.com/docs/traffic-policy/variables/action/#restrict-ips) | Free |
| [actions.ngrok.restrict_ips.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#restrict-ips) | Free |
| [actions.ngrok.restrict_ips.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#restrict-ips) | Free |
| [actions.ngrok.url_rewrite.matches](https://ngrok.com/docs/traffic-policy/variables/action/#url-rewrite) | Free |
| [actions.ngrok.url_rewrite.url](https://ngrok.com/docs/traffic-policy/variables/action/#url-rewrite) | Free |
| [actions.ngrok.url_rewrite.error.code](https://ngrok.com/docs/traffic-policy/variables/action/#url-rewrite) | Free |
| [actions.ngrok.url_rewrite.error.message](https://ngrok.com/docs/traffic-policy/variables/action/#url-rewrite) | Free |
| [actions.ngrok.verify_webhook.verified](https://ngrok.com/docs/traffic-policy/variables/action/#verify-webhook) | Free |
| [conn.bytes_in](https://ngrok.com/docs/traffic-policy/variables/connection/#connbytes_in) | Free |
| [conn.bytes_out](https://ngrok.com/docs/traffic-policy/variables/connection/#connbytes_out) | Free |
| [conn.client_ip](https://ngrok.com/docs/traffic-policy/variables/connection/#connclient_ip) | Free |
| [conn.client_port](https://ngrok.com/docs/traffic-policy/variables/connection/#connclient_port) | Free |
| [conn.server_ip](https://ngrok.com/docs/traffic-policy/variables/connection/#connserver_ip) | Free |
| [conn.server_port](https://ngrok.com/docs/traffic-policy/variables/connection/#connserver_port) | Free |
| [conn.server_region](https://ngrok.com/docs/traffic-policy/variables/connection/#connserver_region) | Free |
| [conn.ts.start](https://ngrok.com/docs/traffic-policy/variables/connection/#conntsstart) | Free |


### Actions

| Name | TPU Cost |
|------|----------|
| [add-headers](https://ngrok.com/docs/traffic-policy/actions/add-headers/) | Free |
| [basic-auth](https://ngrok.com/docs/traffic-policy/actions/basic-auth/) | Free |
| [circuit-breaker](https://ngrok.com/docs/traffic-policy/actions/circuit-breaker/) | 10 TPU |
| [compress-response](https://ngrok.com/docs/traffic-policy/actions/compress-response/) | 10 TPU |
| [custom-response](https://ngrok.com/docs/traffic-policy/actions/custom-response/) | Free |
| [deny](https://ngrok.com/docs/traffic-policy/actions/deny/) | Free |
| [forward-internal](https://ngrok.com/docs/traffic-policy/actions/forward-internal/) | Free |
| [forward-external](https://ngrok.com/docs/traffic-policy/actions/forward-external/) | 10 TPU |
| [http-request](https://ngrok.com/docs/traffic-policy/actions/http-request/) | 1 TPU |
| [jwt-validation](https://ngrok.com/docs/traffic-policy/actions/jwt-validation/) | 10 TPU |
| [log](https://ngrok.com/docs/traffic-policy/actions/log/) | Free |
| [oauth](https://ngrok.com/docs/traffic-policy/actions/oauth/) | Free |
| [oidc](https://ngrok.com/docs/traffic-policy/actions/oidc/) | Free |
| [owasp-crs-request](https://ngrok.com/docs/traffic-policy/actions/owasp-crs-request/) | 10 TPU |
| [owasp-crs-response](https://ngrok.com/docs/traffic-policy/actions/owasp-crs-response/) | 10 TPU |
| [rate-limit](https://ngrok.com/docs/traffic-policy/actions/rate-limit/) | 1 TPU |
| [redirect](https://ngrok.com/docs/traffic-policy/actions/redirect/) | 10 TPU |
| [remove-headers](https://ngrok.com/docs/traffic-policy/actions/remove-headers/) | 1 TPU |
| [restrict-ips](https://ngrok.com/docs/traffic-policy/actions/restrict-ips/) | 10 TPU |
| [saml](https://ngrok.com/docs/traffic-policy/actions/saml/) | Free |
| [set-vars](https://ngrok.com/docs/traffic-policy/actions/set-vars/) | Free |
| [terminate-tls](https://ngrok.com/docs/traffic-policy/actions/terminate-tls/) | 100 TPU |
| [url-rewrite](https://ngrok.com/docs/traffic-policy/actions/url-rewrite/) | 10 TPU |
| [verify-webhook](https://ngrok.com/docs/traffic-policy/actions/verify-webhook/) | 1 TPU |


### Macros

| Name | TPU Cost |
|---|---|
| [b64.decode(string)](https://ngrok.com/docs/traffic-policy/macros/#base64) | 3 TPU per GB after 1 GB |
| [b64.encode(string)](https://ngrok.com/docs/traffic-policy/macros/#base64) | 3 TPU per GB after 1 GB |
| [basic_auth.encode(username, password)](https://ngrok.com/docs/traffic-policy/macros/#basic-auth) | Free |
| [http.header(name)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.header(name, default)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.param(name)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.param(name, default)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.path()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.path_segment(index)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.path_segment(index, default)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.query()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.query_param(name)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.query_param(name, default)](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.remote_addr()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.request_body()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.request_body_json()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.request_body_query()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.request_method()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.request_uri()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.response_body()](https://ngrok.com/docs/traffic-policy/macros/#http-responses) | Free |
| [http.response_body_json()](https://ngrok.com/docs/traffic-policy/macros/#http-responses) | Free |
| [http.response_body_query()](https://ngrok.com/docs/traffic-policy/macros/#http-responses) | Free |
| [http.scheme()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [http.status()](https://ngrok.com/docs/traffic-policy/macros/#http-responses) | Free |
| [http.status_text()](https://ngrok.com/docs/traffic-policy/macros/#http-responses) | Free |
| [http.user_agent()](https://ngrok.com/docs/traffic-policy/macros/#http-requests) | Free |
| [inCidrRange(ip, cidr)](https://ngrok.com/docs/traffic-policy/macros/#utility) | Free |
| [inCidrRanges(ip, cidrs)](https://ngrok.com/docs/traffic-policy/macros/#utility) | Free |
| [json.decode(string)](https://ngrok.com/docs/traffic-policy/macros/#json) | 3 TPU per GB after 1 GB |
| [json.encode(list | map)](https://ngrok.com/docs/traffic-policy/macros/#json) | 3 TPU per GB after 1 GB |
| [list.encodeJson()](https://ngrok.com/docs/traffic-policy/macros/#lists) | Free |
| [object.encodeJson()](https://ngrok.com/docs/traffic-policy/macros/#maps) | Free |
| [object.encodeQueryString()](https://ngrok.com/docs/traffic-policy/macros/#maps) | Free |
| [queryString.decode(string)](https://ngrok.com/docs/traffic-policy/macros/#query-string) | Free |
| [queryString.encode(map)](https://ngrok.com/docs/traffic-policy/macros/#query-string) | Free |
| [rand.double()](https://ngrok.com/docs/traffic-policy/macros/#random) | Free |
| [rand.int(min, max)](https://ngrok.com/docs/traffic-policy/macros/#random) | Free |
| [security.secret(string, string)](https://ngrok.com/docs/traffic-policy/macros/#secrets) | Free |
| [string.decodeBase64()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.decodeJson()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.decodeQueryString()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.encodeBase64()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.escapeUrl()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.isJson()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.isQueryString()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.isURL()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.parseUrl()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [string.unescapeUrl()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [url.escape(string)](https://ngrok.com/docs/traffic-policy/macros/#url) | Free |
| [url.parse(string)](https://ngrok.com/docs/traffic-policy/macros/#url) | Free |
| [url.unescape(string)](https://ngrok.com/docs/traffic-policy/macros/#url) | Free |
| [utility.base64_decode(string)](https://ngrok.com/docs/traffic-policy/macros/#base64) | Free |
| [utility.base64_encode(string)](https://ngrok.com/docs/traffic-policy/macros/#base64) | Free |
| [utility.basic_auth_encode(username, password)](https://ngrok.com/docs/traffic-policy/macros/#basic-auth) | Free |
| [utility.in_cidr_range(ip, cidr)](https://ngrok.com/docs/traffic-policy/macros/#utility) | Free |
| [utility.in_cidr_ranges(ip, cidrs)](https://ngrok.com/docs/traffic-policy/macros/#utility) | Free |
| [utility.json_decode(string)](https://ngrok.com/docs/traffic-policy/macros/#json) | Free |
| [utility.json_encode(list | map)](https://ngrok.com/docs/traffic-policy/macros/#json) | Free |
| [utility.list_encode_json()](https://ngrok.com/docs/traffic-policy/macros/#lists) | Free |
| [utility.object_encode_json()](https://ngrok.com/docs/traffic-policy/macros/#maps) | Free |
| [utility.object_encode_query_string()](https://ngrok.com/docs/traffic-policy/macros/#maps) | Free |
| [utility.query_string_decode(string)](https://ngrok.com/docs/traffic-policy/macros/#query-string) | Free |
| [utility.query_string_encode(map)](https://ngrok.com/docs/traffic-policy/macros/#query-string) | Free |
| [utility.rand_double()](https://ngrok.com/docs/traffic-policy/macros/#random) | Free |
| [utility.rand_int(min, max)](https://ngrok.com/docs/traffic-policy/macros/#random) | Free |
| [utility.string_decode_base64()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_decode_json()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_decode_query_string()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_encode_base64()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_escape_url()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_is_json()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_is_query_string()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_is_url()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_parse_url()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.string_unescape_url()](https://ngrok.com/docs/traffic-policy/macros/#string) | Free |
| [utility.url_escape(string)](https://ngrok.com/docs/traffic-policy/macros/#url) | Free |
| [utility.url_parse(string)](https://ngrok.com/docs/traffic-policy/macros/#url) | Free |
| [utility.url_unescape(string)](https://ngrok.com/docs/traffic-policy/macros/#url) | Free |
### Traffic Policy Units (TPUs) Discounts at Scale

The Pay-as-You go plan discounts TPUs at a large scale, so you don't have to talk to sales tog et a pricepoint that grows as you grow. Discounted pricing is as follows:

| Count | TPU Cost |
|------|----------|
| 0+ | $1/100k |
| 1M+ | $.75/100k |
| 10M+ | $.55/100k |
| 100M+ | $0.35/100k |
| 1B+ | $0.25/100k |
