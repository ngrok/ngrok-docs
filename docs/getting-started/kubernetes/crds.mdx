---
title: "Quickstart: Kubernetes Custom Resources"
sidebar_label: Custom Resources
pagination_next: k8s/guides/using-ingresses
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";
import ConfigExample from "/src/components/ConfigExample.tsx";

import K8sSetup from "./_setup.mdx";
import K8sInstall from "./_install.mdx";

This quickstart uses the [ngrok Kubernetes Operator](/docs/k8s) and a
[ngrok's custom resourecs](/docs/k8s/crds) (CRs) to make the services you've deployed
to Kubernetes available on the public internet.

Benefits:

- ngrok's CRs are easier to configure and require less YAML than either [Ingress](/docs/getting-started/kubernetes/ingress) or [Gateway API](/docs/getting-started/kubernetes/gateway-api) resources.
- TK

Example use cases:

- TK
- TK

:::note
The ngrok Kubernetes Operator is available to all ngrok users at no additional charge.
You only incur costs if the resources provisioned by the controller incur a cost
More details can be found on our [pricing page](https://ngrok.com/pricing).
:::

## What you'll need

- An ngrok account and a [reserved domain](https://dashboard.ngrok.com/domains)
- A running K8s cluster with `kubectl` access with at least one service
- [`kubectl`](https://kubernetes.io/docs/reference/kubectl/) and [Helm](https://helm.sh/docs/intro/install/) 3.0.0 or later installed locally

## 1. Install the ngrok Kubernetes Operator

<K8sSetup />
<K8sInstall />

## 2. Get your domain

Head over to the [**Domains** section](https://dashboard.ngrok.com/domains) and click **+ New Domain** to grab a new domain.
You can choose between a static domain with an ngrok-branded TLD like `.ngrok.app` or `.ngrok.io`, or you can [bring a custom domain](/docs/universal-gateway/custom-domains/).

We'll refer to this as `$YOUR_DOMAIN` from here on out.

## 3. Create your endpoint manifest

You have two options to expose your Kubernetes service with ngrok's CRDs:

1. A single `AgentEndpoint` resource: This option is simplest, but is typically limited to exposing one service on a hostname.
2. A pair of `CloudEndpoint` and `AgentEndpoint` resources: This option allows you to route traffic to any number of Kubernetes services from a single hostname depending on their path, headers, and more using [expressions](/docs/traffic-policy/concepts/expressions/) and the [`forward-internal` Traffic Policy action](/docs/traffic-policy/actions/forward-internal).

This manifest exposes a Kubernetes Service named `hello-world` listening on port `80` on `$YOUR_DOMAIN`.
You'll need to change these three values based on your deployment.

<Tabs groupId="crds" queryString="crd-option">
  <TabItem value="agent-endpoint" label="AgentEndpoint" default>

```yaml title="ngrok-crds.yaml"
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: AgentEndpoint
metadata:
  name: hello-world-endpoint
spec:
  url: https://$YOUR_DOMAIN
  upstream:
    url: http://hello-world.default:80
```

  </TabItem>
  <TabItem value="cloud-agent-endpoint" label="CloudEndpoint + AgentEndpoint">

```yaml title="ngrok-crds.yaml"
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: CloudEndpoint
metadata:
  name: hello-world-cloud-endpoint
spec:
  url: $YOUR_DOMAIN
trafficPolicy:
  policy:
    on_http_request:
      - actions:
        - type: forward-internal
          config:
            url: http://hello-world.internal
---
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: AgentEndpoint
metadata:
  name: hello-world-endpoint
spec:
  url: http://hello-world.internal
  upstream:
    url: http://hello-world.default:80
```

  </TabItem>
</Tabs>

Apply the manifest with `kubectl apply -f ngrok-crds.yaml`.

The ngrok Kubernetes Operator watches your cluster for `AgentEndpoint` and `CloudEndpoint` resources you create and provisions a new agent endpoint to forward traffic into your Service.

You can now send a request to `$NGROK_DOMAIN` with your browser or `curl`.
Your Kubernetes service is now available to anyone on the public internet!

## 4. Secure your app with Traffic Policy

In cases where you need to restrict access to your API or app, ngrok's [Traffic Policy engine](/docs/traffic-policy) and the [`restrict-ips`](/docs/traffic-policy/actions/restrict-ips) let you quickly allow only certain addresses to access your endpoint.

First, copy your public IP address via our [`ip4v.ngrok.com` mini-app](https://ipv4.ngrok.com/).

<Tabs groupId="crds" queryString="crd-option">
  <TabItem value="agent-endpoint" label="AgentEndpoint" default>

Add a `trafficPolicy.inline` field followed by the Traffic Policy rule itself.

```yaml title="ngrok-crds.yaml"
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: AgentEndpoint
metadata:
  name: hello-world-endpoint
spec:
  url: https://$YOUR_DOMAIN
  upstream:
    url: http://hello-world.default:80
  trafficPolicy:
    inline:
			on_http_request:
				- actions:
						- type: restrict-ips
							config:
								enforce: true
								allow:
									- $YOUR_PUBLIC_IP
	```

  </TabItem>
  <TabItem value="cloud-agent-endpoint" label="CloudEndpoint + AgentEndpoint">

Insert the new rule above your existing `forward-internal` action to require authentication before forwarding traffic to your internal agent endpoint.

```yaml title="ngrok-crds.yaml"
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: CloudEndpoint
metadata:
  name: hello-world-cloud-endpoint
spec:
  url: $YOUR_DOMAIN
trafficPolicy:
  policy:
    on_http_request:
			- actions:
					- type: restrict-ips
						config:
							enforce: true
							allow:
								- $YOUR_PUBLIC_IP
      - actions:
        - type: forward-internal
          config:
            url: http://hello-world.internal
---
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: AgentEndpoint
metadata:
  name: hello-world-endpoint
spec:
  url: http://hello-world.internal
  upstream:
    url: http://hello-world.default:80
```

  </TabItem>
</Tabs>

Re-apply the manifest with `kubectl apply -f gwapi.yaml`.

## 5. Start sending requests

If you set up Traffic Policy, you can now verify that your rules are working and your Kubernetes service is accessible from the public internet.

- In your browser: `https://$YOUR_DOMAIN`
- In your terminal: `curl https://$YOUR_DOMAIN`

## What's next?

Learn more about using ngrok with your Kubernetes deployments:

- Create a [Cloud Endpoint directly](/docs/k8s/guides/using-crds/#using-cloudendpoint) with the `CloudEndpoint` CRD
- [Route requests to many upstream services](/docs/k8s/guides/how-to/request-routing/) based on the path, headers, and query parameters
- Deploy an [API gateway](/docs/guides/api-gateway/kubernetes/) in one or [multiple clouds](/docs/guides/api-gateway/multicloud/)

For more ways to filter and manage traffic:

- [Traffic Policy overview](/docs/traffic-policy)
- [Traffic Policy concepts](/docs/traffic-policy/concepts/)
- All our [available actions](/docs/traffic-policy/actions/)

Finally, explore the [Traffic Inspector in your dashboard](https://dashboard.ngrok.com/traffic-inspector) for real-time observability of traffic flowing through your endpoint.
