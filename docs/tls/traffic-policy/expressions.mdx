# Expressions

A policy is written with [Common Expression Language (CEL)](https://github.com/google/cel-spec) expressions
to determine on which connections it is applicable. Each policy expression must evaluate to true in order for
the policy's actions to take effect against a connection.

## Variables

Attributes of the connection are exposed on the `conn` struct. The following variables are available using this struct:

## Variables

Attributes of the connection are exposed on the `conn` struct. The following variables are available using this struct:

| Name                       | Type   | Description                                                                                            |
| -------------------------- | ------ | ------------------------------------------------------------------------------------------------------ |
| [`conn.ClientIP`](#connclientip)            | string | The source IP of the TLS connection to the ngrok endpoint.                                             |
| [`conn.Geo.CountryCode`](#conngeocountrycode)     | string | The two-letter ISO country code based on the client IP.                                                |
| [`conn.Geo.Latitude`](#conngeolatitude)        | string | The approximate latitude based on the client IP.                                                       |
| [`conn.Geo.LatLongRadiusKm`](#conngeolatlongradiuskm) | string | The radius in kilometers around the latitude and longitude where the client IP is likely to originate. |
| [`conn.Geo.Longitude`](#conngeolongitude)       | string | The approximate longitude based on the client IP.                                                      |
| [`conn.TLS.CertCN`](#conntlscertcn)          | string | The subject common name of the leaf TLS certificate                                                    |
| [`conn.TLS.CipherSuite`](#conntlsciphersuite)     | string | The cipher suite negotiated on the connection.                                                         |
| [`conn.TLS.SNI`](#conntlssni)             | string | The Server Name Indication extension sent.                                                             |
| [`conn.TLS.Version`](#conntlsversion)         | string | The TLS Version used on the connection.                                                                |

### `conn.ClientIP`

The source IP of the TCP connection to the ngrok endpoint as a string.

```yaml
- "conn.ClientIP in ['::1', '127.0.0.1']"
```

### `conn.Geo.CountryCode`

The two-letter ISO country code based on the client IP.

```yaml
- "conn.Geo.CountryCode != 'US'"
```

### `conn.Geo.Latitude`

The approximate latitude based on the client IP.

```yaml
- "double(conn.Geo.Latitude) >= 45.0"
```

### `conn.Geo.LatLongRadiusKm`

The radius in kilometers around the latitude and longitude where the client IP is likely to originate.

```yaml
- "conn.Geo.LatLongRadiusKm <= '20'"
```

### `conn.Geo.Longitude`

The approximate longitude based on the client IP.

```yaml
- "double(conn.Geo.Longitude) <= -93.0"
```
### `conn.TLS.CertCN`

The subject common name of the leaf TLS certificate.

```yaml
- "conn.TLS.CertCN.startsWith('example')"
```

### `conn.TLS.CipherSuite`

The cipher suite negotiated on the connection.

```yaml
- "conn.TLS.CipherSuite.contains('SHA256')"
```

### `conn.TLS.SNI`

The Server Name Indication extension sent.

```yaml
- "conn.TLS.SNI.startsWith('domain')"
```

### `conn.TLS.Version`

The TLS Version used on the connection.

```yaml
- "conn.TLS.Version.contains('1.3')"
```

