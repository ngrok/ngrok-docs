import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import AtEdgeKubernetesExample from "/examples/k8s/tls-terminate-at-edge.mdx";
import AtEdgeAgentCliExample from "/examples/agent-cli/tls-terminate-at-edge.mdx";
import AtEdgeAgentConfigExample from "/examples/agent-config/tls-terminate-at-edge.mdx";
import AtEdgeSshExample from "/examples/ssh/tls-terminate-at-edge.mdx";
import AtEdgeGoSdkExample from "/examples/go-sdk/tls-terminate-at-edge.mdx";
import AtEdgeNodejsSdkExample from "/examples/nodejs-sdk/tls-terminate-at-edge.mdx";
import AtEdgePythonSdkExample from "/examples/python-sdk/tls-terminate-at-edge.mdx";
import AtEdgeRustSdkExample from "/examples/rust-sdk/tls-terminate-at-edge.mdx";

import CustomCertKubernetesExample from "/examples/k8s/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertAgentCliExample from "/examples/agent-cli/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertAgentConfigExample from "/examples/agent-config/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertSshExample from "/examples/ssh/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertGoSdkExample from "/examples/go-sdk/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertNodejsSdkExample from "/examples/nodejs-sdk/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertPythonSdkExample from "/examples/python-sdk/tls-terminate-at-edge-custom-cert.mdx";
import CustomCertRustSdkExample from "/examples/rust-sdk/tls-terminate-at-edge-custom-cert.mdx";

import AtAgentKubernetesExample from "/examples/k8s/tls-terminate-at-agent.mdx";
import AtAgentAgentCliExample from "/examples/agent-cli/tls-terminate-at-agent.mdx";
import AtAgentAgentConfigExample from "/examples/agent-config/tls-terminate-at-agent.mdx";
import AtAgentSshExample from "/examples/ssh/tls-terminate-at-agent.mdx";
import AtAgentGoSdkExample from "/examples/go-sdk/tls-terminate-at-agent.mdx";
import AtAgentNodejsSdkExample from "/examples/nodejs-sdk/tls-terminate-at-agent.mdx";
import AtAgentPythonSdkExample from "/examples/python-sdk/tls-terminate-at-agent.mdx";
import AtAgentRustSdkExample from "/examples/rust-sdk/tls-terminate-at-agent.mdx";

import AtUpstreamKubernetesExample from "/examples/k8s/tls-terminate-at-upstream.mdx";
import AtUpstreamAgentCliExample from "/examples/agent-cli/tls-terminate-at-upstream.mdx";
import AtUpstreamAgentConfigExample from "/examples/agent-config/tls-terminate-at-upstream.mdx";
import AtUpstreamSshExample from "/examples/ssh/tls-terminate-at-upstream.mdx";
import AtUpstreamGoSdkExample from "/examples/go-sdk/tls-terminate-at-upstream.mdx";
import AtUpstreamNodejsSdkExample from "/examples/nodejs-sdk/tls-terminate-at-upstream.mdx";
import AtUpstreamPythonSdkExample from "/examples/python-sdk/tls-terminate-at-upstream.mdx";
import AtUpstreamRustSdkExample from "/examples/rust-sdk/tls-terminate-at-upstream.mdx";

# TLS Termination

---

## Overview

This module enables you to configure TLS termination at either your upstream
service, the ngrok edge or the ngrok agent. It also allows you to configure the
parameters of that termination.

By default, TLS endpoints terminate TLS connections at your upstream service.
This means that by default, ngrok does not terminate TLS connections, your
upstream service must handle TLS termination.

Terminating TLS at the ngrok edge is a good choice in the following
circumstances:

- You want ngrok to automatically manage TLS certificate provisioning for you.
- You want ngrok to enforce Mutual TLS. TLS Termination is required to enforce
  mTLS.
- You want to accelerate TLS termination by executing it at ngrok's edge,
  closer to your clients
- Your upstream service can't terminate TLS. This is common for legacy
  software.

## Example Usage

### Terminate at upstream service

<Tabs groupId="connectivity" queryString="cty">
	<TabItem value="agent-cli" label="Agent CLI" default>
		<AtUpstreamAgentCliExample />
	</TabItem>
	<TabItem value="agent-config" label="Agent Config">
		<AtUpstreamAgentConfigExample />
	</TabItem>
	<TabItem value="ssh" label="SSH">
		<AtUpstreamSshExample />
	</TabItem>
	<TabItem value="go-sdk" label="Go">
		<AtUpstreamGoSdkExample />
	</TabItem>
	<TabItem value="nodejs-sdk" label="NodeJS">
		<AtUpstreamNodejsSdkExample />
	</TabItem>
	<TabItem value="python-sdk" label="Python">
		<AtUpstreamPythonSdkExample />
	</TabItem>
	<TabItem value="rust-sdk" label="Rust">
		<AtUpstreamRustSdkExample />
	</TabItem>
	<TabItem value="k8s" label="Kubernetes Controller">
		<AtUpstreamKubernetesExample />
	</TabItem>
</Tabs>

<br />

### Terminate at ngrok edge

<Tabs groupId="connectivity" queryString="cty">
	<TabItem value="agent-cli" label="Agent CLI" default>
		<AtEdgeAgentCliExample />
	</TabItem>
	<TabItem value="agent-config" label="Agent Config">
		<AtEdgeAgentConfigExample />
	</TabItem>
	<TabItem value="ssh" label="SSH">
		<AtEdgeSshExample />
	</TabItem>
	<TabItem value="go-sdk" label="Go">
		<AtEdgeGoSdkExample />
	</TabItem>
	<TabItem value="nodejs-sdk" label="NodeJS">
		<AtEdgeNodejsSdkExample />
	</TabItem>
	<TabItem value="python-sdk" label="Python">
		<AtEdgePythonSdkExample />
	</TabItem>
	<TabItem value="rust-sdk" label="Rust">
		<AtEdgeRustSdkExample />
	</TabItem>
	<TabItem value="k8s" label="Kubernetes Controller">
		<AtEdgeKubernetesExample />
	</TabItem>
</Tabs>

<br />

### Terminate at ngrok agent

<Tabs groupId="connectivity" queryString="cty">
	<TabItem value="agent-cli" label="Agent CLI" default>
		<AtAgentAgentCliExample />
	</TabItem>
	<TabItem value="agent-config" label="Agent Config">
		<AtAgentAgentConfigExample />
	</TabItem>
	<TabItem value="ssh" label="SSH">
		<AtAgentSshExample />
	</TabItem>
	<TabItem value="go-sdk" label="Go">
		<AtAgentGoSdkExample />
	</TabItem>
	<TabItem value="nodejs-sdk" label="NodeJS">
		<AtAgentNodejsSdkExample />
	</TabItem>
	<TabItem value="python-sdk" label="Python">
		<AtAgentPythonSdkExample />
	</TabItem>
	<TabItem value="rust-sdk" label="Rust">
		<AtAgentRustSdkExample />
	</TabItem>
	<TabItem value="k8s" label="Kubernetes Controller">
		<AtAgentKubernetesExample />
	</TabItem>
</Tabs>

<br />

### Custom cert at ngrok edge

<Tabs groupId="connectivity" queryString="cty">
	<TabItem value="agent-cli" label="Agent CLI" default>
		<CustomCertAgentCliExample />
	</TabItem>
	<TabItem value="agent-config" label="Agent Config">
		<CustomCertAgentConfigExample />
	</TabItem>
	<TabItem value="ssh" label="SSH">
		<CustomCertSshExample />
	</TabItem>
	<TabItem value="go-sdk" label="Go">
		<CustomCertGoSdkExample />
	</TabItem>
	<TabItem value="nodejs-sdk" label="NodeJS">
		<CustomCertNodejsSdkExample />
	</TabItem>
	<TabItem value="python-sdk" label="Python">
		<CustomCertPythonSdkExample />
	</TabItem>
	<TabItem value="rust-sdk" label="Rust">
		<CustomCertRustSdkExample />
	</TabItem>
	<TabItem value="k8s" label="Kubernetes Controller">
		<CustomCertKubernetesExample />
	</TabItem>
</Tabs>

## Behavior

### Certificates

The following section will help you resolve any certificate errors you run into while using TLS termination. Because TLS endpoints are flexible enough to terminate TLS at either the ngrok
edge, the ngrok agent or your upstream service, you may encounter
certificate errors. Understanding how the ngrok platform handles certificates can help resolve them quickly.

When you terminate TLS at the ngrok edge, you may choose between bringing your
own certificates and allowing ngrok to automatically provision certificates for
you from an ACME provider like Let's Encrypt. If you use automatic
certificates, ngrok will choose a matching, valid certificate for you and it
will provision and renew that, if necessary. This works even if you're
listening on a randomly-chosen ngrok domain.

When using [Zero-Knowledge TLS](#zero-knowledge-tls) by terminating at the
ngrok agent or at your upstream service, you should always specify a domain.
If you don't specify a domain to listen on, you won't have already provisioned
a signed certificate for that domain. Make sure that the certificate you're
using exactly matches the name of the domain you've asked ngrok to listen on.

### Zero-Knowledge TLS

When TLS is not terminated at the ngrok edge, then your TLS connections are
end-to-end encrypted (E2EE) which we call Zero-Knowledge TLS. When your TLS
endpoints operate in this mode, the ngrok edge can not see the payloads that
transfer through your endpoints.

The ngrok edge enables Zero-Knowledge TLS by using the SNI data of incoming TLS
connections to route them to the proper endpoint without terminating TLS. The
unterminated connections are forwarded all the way through to your upstream
application which is then responsible for TLS termination.

### Zero-Knowledge TLS at the Agent

If the service you are exposing does not support TLS termination, you can still
take advantage of Zero-Knowledge TLS. The ngrok agent can terminate TLS for you
allowing you to encrypt your traffic end-to-end without reconfiguring your
upstream service. This is often a good choice if your upstream service is a
piece of legacy software that doesn't support TLS or if it's operated out of
your control.

Specify `--terminate-at agent` with both the `--crt` and `--key` command-line
options when starting the agent to specify the filesystem paths to your TLS
certificate and key and the ngrok agent will take care of terminating TLS
connections for you.

### TLS Version Choice

If you configure ngrok to do TLS termination, either at the edge or in the
agent, it will prefer to use TLS 1.3 if the client supports it.

When terminating at the ngrok edge, a minimum supported version of TLS 1.2 is
chosen by default. Clients that do not support TLS 1.2 will not be able to
connect. This value is configurable when using Edges.

When terminating at the ngrok agent, a minimum supported version of TLS 1.2 is
chosen by default. Clients that do not support TLS 1.2 will not be able to
connect. This value is not configurable.

## Reference

### Configuration

| Parameter               | Default    | Description                                                                                                                   |
| ----------------------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------- |
| **Terminate At**        | `upstream` | Where to terminate TLS. One of: `edge`, `upstream`, `agent`                                                                   |
| **Minimum TLS Version** | `1.2`      | The minimum version of TLS to negotiate. Clients which do not support at least this version of TLS will be unable to connect. |

### Errors

This module does not return any errors.

### Events

No event data is captured for this module on TLS endpoints.

### Edges

TLS Termination is a supported TLS Edge module.

- [TLS Termination Edge Module API Resource](/api/resources/tls-edge-tls-termination-module/)

### Pricing

This module is available on the Enterprise plan.

## Try it out

:::note Coming Soon

This documentation is incomplete. Please check back later, we appreciate your
patience.

:::
