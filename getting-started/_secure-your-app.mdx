<Tabs>
  <Tab>

  When you restrict access to your app using [Traffic Policy and Google OAuth](/traffic-policy/examples/add-authentication/#sending-an-oidc-identity-token-over-headers), first your users will have to authenticate with Google, then your traffic policy will grant them access based on the rules you configure.

  This example uses ngrok's default managed google application to authenticate users.
  To configure your own Google OAuth application, see the [Google OAuth guide](/integrations/oauth/google-oauth).

  First, create a new file called `traffic-policy.yml` in the root of your project and add the following code:

  <CodeGroup>
  ```yaml policy.yml
  on_http_request:
  - name: OAuth
  actions:
  - type: oauth
    config:
      auth_id: oauth
      provider: google
  - name: bad email
  expressions:
  - actions.ngrok.oauth.identity.email != 'alan@example.com'
  actions:
  - type: custom-response
    config:
      body: Hey, no auth for you ${actions.ngrok.oauth.identity.name}!
      status_code: 400
  ```
  ```json policy.json
  {
  "on_http_request": [
    {
      "name": "OAuth",
      "actions": [
        {
          "type": "oauth",
          "config": {
            "auth_id": "oauth",
            "provider": "google"
          }
        }
      ]
    },
    {
      "name": "bad email",
      "expressions": [
        "actions.ngrok.oauth.identity.email != 'alan@example.com'"
      ],
      "actions": [
        {
          "type": "custom-response",
          "config": {
            "body": "Hey, no auth for you ${actions.ngrok.oauth.identity.name}!",
            "status_code": 400
          }
        }
      ]
    }
  ]
  }
  ```
</CodeGroup>

  Then, start your endpoint with the traffic policy:

  ```bash
  ngrok http 80 --traffic-policy-file /path/to/traffic-policy.yml
  ```

</Tab>
  <Tab>
  {props.children}
</Tab>
</Tabs>

<Tabs>
  <Tab>

  When you restrict access to your app using [Traffic Policy and Google OAuth](/traffic-policy/examples/add-authentication/#sending-an-oidc-identity-token-over-headers), first your users will have to authenticate with Google, then your traffic policy will grant them access based on the rules you configure.

  This example uses ngrok's default managed google application to authenticate users.
  To configure your own Google OAuth application, see the [Google OAuth guide](/integrations/oauth/google-oauth).

  First, create a new file called `traffic-policy.yml` in the root of your project and add the following code:

  <CodeGroup>

  ```yaml policy.yml
  on_http_request:
  - name: OAuth
    actions:
  - type: oauth
        config:
          auth_id: oauth
          provider: google
  - name: bad email
    expressions:
  - actions.ngrok.oauth.identity.email != 'alan@example.com'
    actions:
  - type: custom-response
        config:
          body: Hey, no auth for you ${actions.ngrok.oauth.identity.name}!
          status_code: 400
  ```

  ```json policy.json
  {
  "on_http_request": [
    {
      "name": "OAuth",
      "actions": [
        {
          "type": "oauth",
          "config": {
            "auth_id": "oauth",
            "provider": "google"
          }
        }
      ]
    },
    {
      "name": "bad email",
      "expressions": ["actions.ngrok.oauth.identity.email != 'alan@example.com'"],
      "actions": [
        {
          "type": "custom-response",
          "config": {
            "body": "Hey, no auth for you ${actions.ngrok.oauth.identity.name}!",
            "status_code": 400
          }
        }
      ]
    }
  ]
  }
  ```

</CodeGroup>

  Then, start your endpoint with the traffic policy:

  ```bash
  ngrok http 80 --traffic-policy-file /path/to/traffic-policy.yml
  ```

</Tab>
  <Tab>
  {props.children}
</Tab>
</Tabs>
