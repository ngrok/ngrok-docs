import RandomAgentCliExample from "/snippets/examples/agent-cli/tcp-random.mdx";
import RandomGoSdkExample from "/snippets/examples/go-sdk/tcp-random.mdx";
import RandomJavascriptSdkExample from "/snippets/examples/javascript-sdk/tcp-random.mdx";
import RandomKubernetesExample from "/snippets/examples/k8s/tcp-random.mdx";
import RandomPythonSdkExample from "/snippets/examples/python-sdk/tcp-random.mdx";
import RandomRustSdkExample from "/snippets/examples/rust-sdk/tcp-random.mdx";
import RandomSshExample from "/snippets/examples/ssh/tcp-random.mdx";
import FixedAgentCliExample from "/snippets/examples/agent-cli/tcp-fixed.mdx";
import FixedGoSdkExample from "/snippets/examples/go-sdk/tcp-fixed.mdx";
import FixedJavascriptSdkExample from "/snippets/examples/javascript-sdk/tcp-fixed.mdx";
import FixedKubernetesExample from "/snippets/examples/k8s/tcp-fixed.mdx";
import FixedPythonSdkExample from "/snippets/examples/python-sdk/tcp-fixed.mdx";
import FixedRustSdkExample from "/snippets/examples/rust-sdk/tcp-fixed.mdx";
import FixedSshExample from "/snippets/examples/ssh/tcp-fixed.mdx";
import NonLocalAgentCliExample from "/snippets/examples/agent-cli/tcp-nonlocal.mdx";
import NonLocalGoSdkExample from "/snippets/examples/go-sdk/tcp-nonlocal.mdx";
import NonLocalJavascriptSdkExample from "/snippets/examples/javascript-sdk/tcp-nonlocal.mdx";
import NonLocalKubernetesExample from "/snippets/examples/k8s/tcp-nonlocal.mdx";
import NonLocalPythonSdkExample from "/snippets/examples/python-sdk/tcp-nonlocal.mdx";
import NonLocalRustSdkExample from "/snippets/examples/rust-sdk/tcp-nonlocal.mdx";
import NonLocalSshExample from "/snippets/examples/ssh/tcp-nonlocal.mdx";
import ProxyProtoAgentCliExample from "/snippets/examples/agent-cli/tcp-proxyproto.mdx";
import ProxyProtoGoSdkExample from "/snippets/examples/go-sdk/tcp-proxyproto.mdx";
import ProxyProtoJavascriptSdkExample from "/snippets/examples/javascript-sdk/tcp-proxyproto.mdx";
import ProxyProtoKubernetesExample from "/snippets/examples/k8s/tcp-proxyproto.mdx";
import ProxyProtoPythonSdkExample from "/snippets/examples/python-sdk/tcp-proxyproto.mdx";
import ProxyProtoRustSdkExample from "/snippets/examples/rust-sdk/tcp-proxyproto.mdx";
import ProxyProtoSshExample from "/snippets/examples/ssh/tcp-proxyproto.mdx";

## Overview

TCP endpoints enable you to deliver any network service with a TCP-based
protocol. They are commonly used to create connectivity for:

- Remote access protocols like SSH, VNC and RDP
- Databases like MySQL, Postgres, MSSQL and SQLite
- IoT protocols like MQTT
- Gaming servers like Minecraft

If you are accepting TLS traffic, you may prefer to create a [TLS Endpoint](/universal-gateway/tls/).

<Info title="Free Plan Usage">
  TCP endpoints are only available on a free plan after [adding a valid payment
  method](https://dashboard.ngrok.com/settings#id-verification) to your account.
</Info>

## Quickstart

Agent Endpoints are the easiest way to get started with ngrok. An [agent
endpoint](/universal-gateway/cloud-endpoints/) is started by a
[Secure Tunnels](/agent/) agent. The endpoint lives for the lifetime
of the process and forwards traffic to a port or URL of your choosing.

This example creates a TCP endpoint on a randomly assigned URL - for example,
`tcp://1.tcp.ngrok.io:12345` and forwards its traffic to a local port.

<Tabs>
	<Tab title="Agent CLI">
		<RandomAgentCliExample />
	</Tab>
	<Tab title="Agent Config">
		<RandomAgentConfigExample />
	</Tab>
	<Tab title="SSH -R">
		<RandomSshExample />

<Tip>
    	See [the guide on using ngrok with SSH](/using-ngrok-with/ssh) to use simple SSH instead of SSH -R.

</Tip>
    </Tab>
    <Tab title="Go">
    	<RandomGoSdkExample />
    </Tab>
    <Tab title="Javascript">
    	<RandomJavascriptSdkExample />
    </Tab>
    <Tab title="Python">
    	<RandomPythonSdkExample />
    </Tab>
    <Tab title="Rust">
    	<RandomRustSdkExample />
    </Tab>
    <Tab title="Kubernetes Controller">
    	<RandomKubernetesExample />
    </Tab>

</Tabs>

## URLs

URLs are validated differently depending on their
[binding](/universal-gateway/bindings). Consult the
following documentation for details on valid URLs for TCP endpoints:

- [Public Endpoint URLs](/universal-gateway/public-endpoints/#tcp)
- [Internal Endpoint URLs](/universal-gateway/internal-endpoints/#urls)
- [Kubernetes Endpoint URLs](/universal-gateway/kubernetes-endpoints/#urls)

There is no standard scheme for TCP URLs so ngrok renders them as `tcp://`.

### Static URLs

If you would like a public TCP endpoint to have a static URL, you must first
create a [TCP Address](/universal-gateway/tcp-addresses). When you create a TCP
address, a random hostname and port will be assigned to you, for example,
`1.tcp.ngrok.io:12345`.

A TCP address is only needed to make a public TCP endpoint have a static URL.
They are not needed for TCP endpoints on other bindings, like `internal` or
`kubernetes`.

After you have created a TCP Address, specify the address (for example,
`1.tcp.eu.ngrok.io:12345`) in the URL when you create the endpoint.

<Tabs>
  <Tab title="Agent CLI">
    <FixedAgentCliExample />
  </Tab>
  <Tab title="Agent Config">
    <FixedAgentConfigExample />
  </Tab>
  <Tab title="SSH Reverse Tunnel">
    <FixedSshExample />
  </Tab>
  <Tab title="Go">
    <FixedGoSdkExample />
  </Tab>
  <Tab title="Javascript">
    <FixedJavascriptSdkExample />
  </Tab>
  <Tab title="Python">
    <FixedPythonSdkExample />
  </Tab>
  <Tab title="Rust">
    <FixedRustSdkExample />
  </Tab>
  <Tab title="Kubernetes Controller">
    <FixedKubernetesExample />
  </Tab>
</Tabs>

### Custom domains

Public TCP endpoints are assigned randomly on an ngrok-controlled hostname with
a randomly assigned port. You may not choose the hostname and you may not
select the port.

You may, however, simulate a customized hostname by creating a CNAME record to
the hostname of your assigned TCP address. If you do so, be aware that all
ports on that hostname, even those provisioned to other accounts will then be
available on your domain.

For example if your TCP address is `5.tcp.ngrok.io:12345`, you could create the
following CNAME record:

```
CNAME tcp.mydomain.com -> 5.tcp.ngrok.io
```

And then you can access that TCP endpoint with

```
telnet tcp.mydomain.com 12345
```

## Traffic Policy

Attach [Traffic Policy](/traffic-policy/) to endpoints to route, authenticate
and transform the traffic through the endpoint.

### Authentication

When you create public TCP endpoints, you often want to secure them with
authentication. You can secure your TCP endpoints with the following [Traffic
Policy](/traffic-policy/) actions. There is a limited set of actions available
to authenticate TCP traffic because the TCP protocol is low-level.

- [IP Restriction](/traffic-policy/actions/restrict-ips/)
- [Mutual TLS](/traffic-policy/actions/terminate-tls/)

## Agent forwarding

The [ngrok agent](/agent/) and [Agent
SDKs](/agent-sdks/) forward traffic that your endpoints receive
to upstream services. You specify a URL or port number to instruct the ngrok
agent where and how to forward traffic.

### Forward to non-local service

Agents don't just forward to ports on your localhost. You can forward traffic
to any address or URL reachable from the agent. For example, if you want to
forward traffic to a Postgres server running on your network at
`192.168.1.2:5432`:

<Tabs>
  <Tab title="Agent CLI">
    <NonLocalAgentCliExample />
  </Tab>
  <Tab title="Agent Config">
    <NonLocalAgentConfigExample />
  </Tab>
  <Tab title="SSH Reverse Tunnel">
    <NonLocalSshExample />
  </Tab>
  <Tab title="Go">
    <NonLocalGoSdkExample />
  </Tab>
  <Tab title="Javascript">
    <NonLocalJavascriptSdkExample />
  </Tab>
  <Tab title="Python">
    <NonLocalPythonSdkExample />
  </Tab>
  <Tab title="Rust">
    <NonLocalRustSdkExample />
  </Tab>
  <Tab title="Kubernetes Controller">
    <NonLocalKubernetesExample />
  </Tab>
</Tabs>

### PROXY Protocol

When you forward traffic to an upstream TCP service, because traffic is coming
from the ngrok agent, it won't know the client's original IP address. You can
add the [PROXY
protocol](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt) header
on connections to your upstream service to send connection information like the
original client IP address to your upstream service. You will need to configure
your upstream service to handle the PROXY protocol header.

<Tabs>
  <Tab title="Agent CLI">
    <ProxyProtoAgentCliExample />
  </Tab>
  <Tab title="Agent Config">
    <ProxyProtoAgentConfigExample />
  </Tab>
  <Tab title="SSH Reverse Tunnel">
    <ProxyProtoSshExample />
  </Tab>
  <Tab title="Go">
    <ProxyProtoGoSdkExample />
  </Tab>
  <Tab title="Javascript">
    <ProxyProtoJavascriptSdkExample />
  </Tab>
  <Tab title="Python">
    <ProxyProtoPythonSdkExample />
  </Tab>
  <Tab title="Rust">
    <ProxyProtoRustSdkExample />
  </Tab>
  <Tab title="Kubernetes Controller">
    <ProxyProtoKubernetesExample />
  </Tab>
</Tabs>

## Observability

### Traffic Inspector

[Traffic Inspector](/obs/traffic-inspection) does not support TCP endpoints.

### Log exports

You can export logs of traffic to TCP endpoints with [ngrok's events
system](/obs/events/). The following events are published for log exporting:

| Log                                                                      | When                                                         |
| ------------------------------------------------------------------------ | ------------------------------------------------------------ |
| [tcp_connection_closed.v0](/obs/events/reference/#tcp-connection-closed) | Published when a TCP connection to a TCP endpoint completes. |

## Limits & timeouts

[Contact Support](mailto:support@ngrok.com) if you need to configure limits and timeouts on
connections to TCP endpoints.

| Limit     | Name                | Notes                                                        |
| --------- | ------------------- | ------------------------------------------------------------ |
| 5 minutes | Client Idle Timeout | Time since data was last transmitted by the upstream service |
| 5 minutes | Server Idle Timeout | Time since data was last transmitted by the upstream service |
| No limit  | Data transmitted    | Data transmitted by the client or upstream service           |

## Errors

If an error is encountered while handling connections to a TCP endpoint for any
reason (for example, Traffic Policy action error, internal server error), the
connection will be closed. Because of the low-level nature of the TCP protocol,
there is no mechanism used to transmit information about what error code was
encountered.

Use the [observability](#observability) features to understand connection
handling errors.

## API

TCP Endpoints can be created programmatically. Consult the documentation on
[Endpoint APIs](/api-reference/endpoints/list.

## Pricing

TCP endpoints are available on all plans. Consult the [Endpoints
Pricing](/universal-gateway/endpoints/#pricing) documentation for
billing details.

TCP endpoints are only available on a free plan after [adding a valid payment
method](https://dashboard.ngrok.com/settings#id-verification) to your account.

See [TCP Addresses pricing](/universal-gateway/tcp-addresses/#pricing) for
details on pricing for fixed TCP Addresses.
