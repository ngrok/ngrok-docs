```go
import (
	"context"
	"fmt"
	"log"
	"net/http"

	"golang.ngrok.com/ngrok/v2"
)

func main() {
	if err := run(context.Background()); err != nil {
		log.Fatal(err)
	}
}

const trafficPolicy = `
on_http_request:
  - name: OAuth
    actions:
      - type: oauth
        config:
          auth_id: oauth
          provider: google
  - name: bad email
    expressions:
      - actions.ngrok.oauth.identity.email != 'alan@example.com'
    actions:
      - type: custom-response
        config:
          body: Access denied: ${actions.ngrok.oauth.identity.name}!
          status_code: 403
`

func run(ctx context.Context) error {
	// Create an HTTP listener with the traffic policy
	ln, err := ngrok.Listen(ctx,
		ngrok.WithTrafficPolicy(trafficPolicy),
		ngrok.WithDescription("traffic policy example"),
	)
	if err != nil {
		return err
	}
	// Serve HTTP traffic on the ngrok endpoint
	log.Println("Endpoint online", ln.URL())
	return http.Serve(ln, http.HandlerFunc(handler))
}

func handler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, "Hello, %s\n", r.Header.Get("authenticated-user"))
}

```

Go Package Docs:

- [https://pkg.go.dev/golang.ngrok.com/ngrok/config#WithTrafficPolicy](https://pkg.go.dev/golang.ngrok.com/ngrok/config#WithTrafficPolicy)
